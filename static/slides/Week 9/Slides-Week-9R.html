<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Multiple Sampling</title>
    <meta charset="utf-8" />
    <meta name="author" content="Week 9" />
    <script src="Slides-Week-9R_files/header-attrs-2.11/header-attrs.js"></script>
    <link href="Slides-Week-9R_files/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="Slides-Week-9R_files/tile-view-0.2.6/tile-view.js"></script>
    <link href="Slides-Week-9R_files/animate.css-3.7.2/animate.xaringan.css" rel="stylesheet" />
    <link href="Slides-Week-9R_files/tachyons-4.12.0/tachyons.min.css" rel="stylesheet" />
    <script src="Slides-Week-9R_files/kePrint-0.0.1/kePrint.js"></script>
    <link href="Slides-Week-9R_files/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="Slides-Week-9R_files/twitter-widget-0.0.1/widgets.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Multiple Sampling
### Week 9

---


&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"&gt;&lt;/script&gt;

&lt;script type="text/x-mathjax-config"&gt;
MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
  MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
    cancel: ["Extension","cancel"],
    bcancel: ["Extension","cancel"],
    xcancel: ["Extension","cancel"],
    cancelto: ["Extension","cancel"]
  });
});
&lt;/script&gt;

&lt;style&gt;
section {
    display: flex;
    display: -webkit-flex;
}

section p {
    margin: auto;
}

section {
    height: 600px;
    width: 60%;
    margin: auto;
    border-radius: 20px;
    background-color: #212121;
}

section p {
    text-align: center;
    font-size: 30px;
    background-color: #212121;
    border-radius: 20px;
    font-family: Roboto Condensed;
    font-style: bold;
    padding: 15px;
    color: #bff4ee;
}

#center {

text-align: center;

}

.center p {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);

&lt;/style&gt;



<div>
<style type="text/css">.xaringan-extra-logo {
width: 110px;
height: 128px;
z-index: 0;
background-image: url(/Users/skynet/Documents/WVU/Teaching/GitHub.nosync/Workspace/edp613/static/img/course_hex.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:1em;right:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('a')
          logo.classList = 'xaringan-extra-logo'
          logo.href = 'https://edp613.asocialdatascientist.com'
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>

# Packages needed and a Note about Icons

Please load up the following packages. Remember to first install the ones you don't have.

```r
library(tidyverse)
library(mosaic)
library(ggplot2movies)
```

You may come across the following icons. The table below lists what each means.


&lt;table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;background-color: #181818 !important;"&gt; Icon &lt;/th&gt;
   &lt;th style="text-align:left;background-color: #181818 !important;"&gt; Description &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;width: 10em; background-color: #181818 !important;"&gt; &lt;svg aria-hidden="true" role="img" viewbox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:
#4682b4;overflow:visible;position:relative;"&gt;&lt;path d="M500.5 231.4l-192-160C287.9 54.3 256 68.6 256 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2zm-256 0l-192-160C31.9 54.3 0 68.6 0 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2z"&gt;&lt;/path&gt;&lt;/svg&gt; &lt;/td&gt;
   &lt;td style="text-align:left;width: 40em; background-color: #181818 !important;"&gt; Indicates that an example continues on the following slide. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;width: 10em; background-color: #181818 !important;"&gt; &lt;svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#ff6347;overflow:visible;position:relative;"&gt;&lt;path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"&gt;&lt;/path&gt;&lt;/svg&gt; &lt;/td&gt;
   &lt;td style="text-align:left;width: 40em; background-color: #181818 !important;"&gt; Indicates that a section using common syntax has ended. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;width: 10em; background-color: #181818 !important;"&gt; &lt;svg aria-hidden="true" role="img" viewbox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#5cb85c;overflow:visible;position:relative;"&gt;&lt;path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"&gt;&lt;/path&gt;&lt;/svg&gt; &lt;/td&gt;
   &lt;td style="text-align:left;width: 40em; background-color: #181818 !important;"&gt; Indicates that there is an active hyperlink on the slide. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;width: 10em; background-color: #181818 !important;"&gt; &lt;svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#5cb85c;overflow:visible;position:relative;"&gt;&lt;path d="M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"&gt;&lt;/path&gt;&lt;/svg&gt; &lt;/td&gt;
   &lt;td style="text-align:left;width: 40em; background-color: #181818 !important;"&gt; Indicates that a section covering a concept has ended. &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
---

# Back to the bar chart

Now that we know how to pivot, we can just `group_by` genre type and then `tally`

```r
movies_by_genre &lt;- movies %&gt;%
            select(Action, Animation, Comedy,
                   Drama, Documentary, Romance, Short) %&gt;%
            pivot_longer(everything(),
                         names_to = "genre") %&gt;%
            group_by(genre) %&gt;%
            dplyr::tally(value)

movies_by_genre
```

```
## # A tibble: 7 × 2
##   genre           n
##   &lt;chr&gt;       &lt;int&gt;
## 1 Action       4688
## 2 Animation    3690
## 3 Comedy      17271
## 4 Documentary  3472
## 5 Drama       21811
## 6 Romance      4744
## 7 Short        9458
```
.right[<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#ff6347;overflow:visible;position:relative;"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"/></svg>]

---


```r
ggplot(movies_by_genre,
       aes(x = genre, 
           y = n, 
           fill = -n)) +
  geom_bar(stat='identity', 
           show.legend = FALSE) +
  labs(title = "Count of Genre", x = "Genre", y = "Count") +
  theme_minimal()
```

&lt;img src="Slides-Week-9R_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;

---

# Back to the movies

Let's take a look at the ratings


```r
pop &lt;- movies %&gt;% 
  ggplot(aes(x = rating, fill = -..count..)) +
  geom_histogram(color = "white", 
                 bins = 20,
                 show.legend = FALSE) +
  theme_minimal()

pop
```

&lt;img src="Slides-Week-9R_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

---

# Purpose

We would like to produce a confidence interval for the population mean rating. Let's first pretend we had to take a sample of `\(n=70\)` from the `\(N= 58788\)` movies. To do this, we'll use the `sample_n` command from the `dplyr` package.


```r
set.seed(999) # Random number generator
movies_sample &lt;- 
  movies %&gt;% 
  sample_n(70)
```

Let's see what this looks like


```r
ggplot(movies_sample, aes(x = rating, fill = -..count..)) +
       geom_histogram(color = "white", 
                      bins = 20,
                      show.legend = FALSE) +
       theme_minimal()
```

&lt;img src="Slides-Week-9R_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" /&gt;

---

# Population Estimation

We can think of the histogram as an estimate of our population distribution histogram that we plotted earlier so a population mean rating will provide a good estimate. To estimate a plausible range of values, we can start by using the mean of the sample. A good way to to this is to add parentheses around a variable declaration like so


```r
(movies_sample_mean &lt;- movies_sample %&gt;% 
   summarize(mean = mean(rating)))
```

```
## # A tibble: 1 × 1
##    mean
##   &lt;dbl&gt;
## 1  5.81
```

This values is only a single estimation. What you did earlier was top keep sampling from the population, or what is known as **sampling with replacement**. 

.right[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#4682b4;overflow:visible;position:relative;"><path d="M500.5 231.4l-192-160C287.9 54.3 256 68.6 256 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2zm-256 0l-192-160C31.9 54.3 0 68.6 0 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2z"/></svg>]
---

# Sampling with Replacement

To do this, we can use the `resample` command from the `mosaic` package. Let's see one instance of this.


```r
resample(movies_sample) %&gt;%
  arrange(orig.id) %&gt;% 
  summarize(mean = mean(rating))
```

```
## # A tibble: 1 × 1
##    mean
##   &lt;dbl&gt;
## 1  5.75
```

But again, this is only one sample mean. 

---

To do a whole bunch we can run a `do` command with parentheses like so


```r
do(10) * 
  (resample(movies_sample) %&gt;% 
     summarize(mean = mean(rating)))
```

```
##        mean
## 1  5.842857
## 2  6.090000
## 3  5.572857
## 4  5.777143
## 5  5.408571
## 6  5.815714
## 7  6.010000
## 8  5.738571
## 9  5.547143
## 10 5.640000
```

.right[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#4682b4;overflow:visible;position:relative;"><path d="M500.5 231.4l-192-160C287.9 54.3 256 68.6 256 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2zm-256 0l-192-160C31.9 54.3 0 68.6 0 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2z"/></svg>]

But a sample of 10 is so lame. Let's think big and try 10000!


```r
not_lame &lt;- do(10000) * summarize(resample(movies_sample), 
                                  mean = mean(rating))
```

---

# Estimating the population


```r
samp &lt;- ggplot(data = not_lame , 
       mapping = aes(x = mean,
                     fill = -..count..)) +
  geom_histogram(bins = 30, 
                 color = "white",
                 show.legend = FALSE) +
  theme_minimal()

samp
```

&lt;img src="Slides-Week-9R_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" /&gt;

---

# Comparison

On the left is our sample distribution while on the right is the original population distribution.

&lt;img src="Slides-Week-9R_files/figure-html/unnamed-chunk-15-1.png" style="display: block; margin: auto;" /&gt;

The distribution of the sample means estimates the population pretty well! If we took even more samples, it would eventually look nearly identical.

---

# Shortcut: Naming and Outputting a Data Frame

There are many approaches that you can take to shorten the number of steps taken to get what you want. While knowing the "long" way gives you the greatest flexibility, if you absolutely know where you're going then knowing shortcuts will make your life easier. Here are two ways to name a data frame and see the output at the same time:

.pull-left[
&lt;center&gt;
&lt;i&gt;Add parentheses to the entire chunk&lt;/i&gt;
&lt;/center&gt;

```r
(way1 &lt;- 
    starwars %&gt;%
    head() %&gt;%
    select(name, height, hair_color))
```

```
## # A tibble: 6 × 3
##   name           height hair_color 
##   &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;      
## 1 Luke Skywalker    172 blond      
## 2 C-3PO             167 &lt;NA&gt;       
## 3 R2-D2              96 &lt;NA&gt;       
## 4 Darth Vader       202 none       
## 5 Leia Organa       150 brown      
## 6 Owen Lars         178 brown, grey
```
]

.pull-right[
&lt;center&gt;
&lt;i&gt;Add a semicolon and name after the chunk &lt;/i&gt;
&lt;/center&gt;

```r
way2 &lt;- 
    starwars %&gt;%
    head() %&gt;%
    select(name, height, hair_color); way2
```

```
## # A tibble: 6 × 3
##   name           height hair_color 
##   &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;      
## 1 Luke Skywalker    172 blond      
## 2 C-3PO             167 &lt;NA&gt;       
## 3 R2-D2              96 &lt;NA&gt;       
## 4 Darth Vader       202 none       
## 5 Leia Organa       150 brown      
## 6 Owen Lars         178 brown, grey
```
]

---

# Confidence using quantiles

We can now calculate a confidence interval using many options. Let's first isolate the middle 95% of values which corresponds to a 95% confidence interval for the population mean rating.


```r
(ci95_mean &lt;- confint(not_lame, 
                      level = 0.95, 
                      method = "quantile"))
```

```
##   name lower    upper level     method estimate
## 1 mean  5.49 6.134286  0.95 percentile 5.814286
```

Based on the sample data and bootstrapping techniques, we can be 95% confident that the true mean rating of ALL IMDB ratings is between 5.49 and about 6.13.

---

# Confidence using the standard error

Recall that the **standard error** is the standard deviation of the sampling distribution and is approximated by the bootstrap distribution or the null distribution depending on the context. To do this we can use the same function as before but only by changing the method


```r
(ci95_mean &lt;- confint(not_lame, 
                      level = 0.95, 
                      method = "stderr"))
```

```
## Warning: confint: Using df = Inf.
```

```
##   name    lower    upper level method estimate margin.of.error
## 1 mean 5.488224 6.139428  0.95 stderr 5.814286       0.3256022
```

The interpretation is virtually the same here.

---

## Thats it!

&lt;center&gt;
<blockquote class="twitter-tweet" data-width="220" data-lang="en" data-dnt="true" data-theme="dark"><p lang="en" dir="ltr">Yeah I just taught pivot_longer() in a class of 100 and the reaction was just a collective &quot;OK cool whatever&quot; while I&#39;m up there like <a href="https://t.co/gLuOuzoCmf">pic.twitter.com/gLuOuzoCmf</a></p>&mdash; Allison Horst (@allison_horst) <a href="https://twitter.com/allison_horst/status/1190001300622036992?ref_src=twsrc%5Etfw">October 31, 2019</a></blockquote>

&lt;/center&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
