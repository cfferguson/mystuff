---
title: "An Incomplete Review of Descriptive Statistics Commands in R"
subtitle: "EDP 613"
author: "Week 7"
output: 
 xaringan::moon_reader:
   css: xaringan-themer.css
---

```{r setup, include=FALSE, purl=FALSE}
library(tidyverse)
library(fontawesome)
library(knitr)
library(kableExtra)
```

```{r echo = FALSE, purl=FALSE}
xaringanthemer::style_duo(
  primary_color = "#212121",
  secondary_color = "#fcbb86",
  text_bold_color = "#fc868c",
  code_inline_color = "#86c7fc",
  header_font_google = xaringanthemer::google_font("Jost", "600"),
  text_font_google   = xaringanthemer::google_font("Jost", "400")
)
xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css", "tachyons"))
```

# Packages needed and a Note about Icons

Please load up the `tidyverse` package
```{r echo = TRUE, eval = TRUE, message=FALSE}
library(tidyverse)
``` 
<br>
<br>
You may come across the following icons. The table below lists what each means.
```{r eval = TRUE, echo = FALSE, purl=FALSE}
forward <- as.character(fontawesome::fa("forward", fill = "
#4682b4"))

stop <- as.character(fontawesome::fa("stop", fill = "#ff6347"))

link <- as.character(fontawesome::fa("link", fill = "#5cb85c"))

bookmark <- as.character(fontawesome::fa("bookmark", fill = "#5cb85c"))

icon_desc <- tibble(
  
  Icon = c(forward,
           stop, 
           link,
           bookmark),
  
  Description = c("Indicates that an example continues on the following slide.",
                  "Indicates that a section using common syntax has ended.",
                  "Indicates that there is an active hyperlink on the slide.",
                  "Indicates that a section covering a concept has ended.")
  
)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, purl=FALSE}
kable(icon_desc, 
      escape = FALSE,
      align = 'cl') %>%
  kable_styling(full_width = FALSE) %>%
  column_spec(1, width = "10em") %>%
  column_spec(2, width = "40em") %>%
  row_spec(0, background = "#181818") %>%
  row_spec(1, background = "#181818") %>%
  row_spec(2, background = "#181818") %>%
  row_spec(3, background = "#181818") %>%
  row_spec(4, background = "#181818") 
```

---

# Descriptives

We're going to use the Star Wars data set that's included in `dplyr`

```{r}
data(starwars)
```
 
```{r}
starwars
```

---

##  View a Portion of the Data Set

```{r}
head(starwars)
```

---

## Counts

**Total number of names**

Tidy approach <br>
```{r echo = TRUE, eval = TRUE}
    starwars %>%
       select(name) %>%
       nrow()
```

Base R approach <br>
```{r echo = TRUE, eval = TRUE}
length(starwars$name)
```

.right[`r fa("stop", fill = "#ff6347")`]

---

## Column Types

Using `str`
```{r echo = TRUE, eval = TRUE}
str(starwars)
```

or....

---

Using `glimpse`
```{r echo = TRUE, eval = TRUE}
glimpse(starwars)
```

.right[`r fa("stop", fill = "#ff6347")`]

---

## Frequencies

```{r echo = TRUE, eval = TRUE}
starwars %>%
  count(sex)
```

.right[`r fontawesome::fa(name = "stop", fill = "#ff6347")`]

---

## Measures of Central Tendency
**Mean**
```{r echo = TRUE, eval = TRUE}
starwars %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(mean(birth_year)) %>%
  rename(`mean age by species` = `mean(birth_year)`) %>%
  ungroup()
```

---

### Side Note: Using Base R vs. Tidy

Either is fine but think about the outcome and what you're going to do with it. Let's take the `mean` again with a fake data set from taste test ratings using two varieties of bananas: cavendish and ice cream.

```{r echo = TRUE, eval = TRUE}
banana_data <- tibble(
  id = c(1,2,3,4,5),
  cav_cat = c("Excellent", "Above Average", "Very Poor", "Average", 
              "Excellent"),
  cav_code = c(5,4,1,3,5),
  ic_cat = c("Excellent", "Excellent", "Above Average", "Excellent", 
             "Excellent"), 
  ic_code = c(5,5,4,5,5)
)
```

.right[`r fa("forward", fill = "#4682b4")`]

.pull-right[.footnote[If you are wondering, the blue java - aka the [ice cream banana](https://www.abc15.com/news/state/planet-arizona-blue-bananas-exist-and-they-taste-like-vanilla-ice-cream) is real.]]

---
```{r echo = TRUE, eval = TRUE}
banana_data
```

.right[`r fa("forward", fill = "#4682b4")`]

---

If we just wanted to find the means, then the Base R method is likely simpler
```{r echo = TRUE, eval = TRUE}
mean(banana_data$cav_code)
```

```{r echo = TRUE, eval = TRUE}
mean(banana_data$ic_code)
```

but if we wanted to pass that output along say to find the range of the means, the Tidy way is a simpler and more efficient approach
```{r echo = TRUE, eval = TRUE}
banana_data %>%
  summarise(mean_cav = mean(cav_code), 
            mean_ic = mean(ic_code)) %>%
  mutate(range_means = mean_ic - mean_cav)
```

---

**Median**
```{r echo = TRUE, eval = TRUE}
starwars %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(median(birth_year)) %>%
  rename(`median age by species` = `median(birth_year)`) %>%
  ungroup()
```

---

**Mode** <br><br>
Remember that `mode` means something else in R. Instead first run the chunk below
```{r}
Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}
```

.right[`r fa("forward", fill = "#4682b4")`]

---

Then you can find the `Mode`
```{r echo = TRUE, eval = TRUE}
starwars %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(Mode(birth_year)) %>%
  rename(`mode age by species` = `Mode(birth_year)`) %>%
  ungroup()
```

---

**Mean by Value**
Sometimes you need to find a measure for a particular subgroup. In this example, we only want to find the birth year for the female classification of each species. One way to accomplish this is to use the `filter` command to get what we want. 
```{r echo = TRUE, eval = TRUE}
starwars %>%
  filter(gender == "feminine") %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(mean(birth_year)) %>%
  rename(`female mean age by species` = `mean(birth_year)`) %>%
  ungroup() %>%
  na.omit()
```

---

## Measures of Spread
**Sample Standard Deviation**
```{r echo = TRUE, eval = TRUE}
starwars %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(sd(birth_year)) %>%
  rename(`age standard deviation by species` = `sd(birth_year)`) %>%
  ungroup() %>%
  na.omit()
```

---

**Population Standard Deviation**<br><br>
Reflecting common assumptions and practice, most descriptive statistics in R do not assume that you have an entire population. So you should ***always assume that you have a sample unless the description explicitly says otherwise***. When you do come across with a population, run the following first
```{r echo = TRUE, eval = TRUE}
pop_sd <- function(x) sd(x) * (length(x)-1) / length(x)
```

and then calculate the population standard deviation
```{r echo = TRUE, eval = TRUE}
starwars %>%
 group_by(species) %>%
 na.omit() %>%
 summarise(pop_sd(birth_year)) %>%
 rename(`age standard deviation by species` = `pop_sd(birth_year)`) %>%
 ungroup() %>%
 na.omit()
```

---

**Sample Variance**
```{r echo = TRUE, eval = TRUE}
starwars %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(var(birth_year)) %>%
  rename(`age variance by species` = `var(birth_year)`) %>%
  ungroup() %>%
  na.omit()
```
<br>
.pull-right[.footnote[You can find a list of commands that may be used with `summarise` [here](https://www.guru99.com/r-aggregate-function.html)]]

---

**Population Variance**<br><br>
Paralleling the arguement given about the population standard deviation, when you have a known population and want to find the varaince, first run
```{r echo = TRUE, eval = TRUE}
pop_var <- function(x) var(x) * (length(x)-1) / length(x)
```

and then you can calculate the population variance
```{r echo = TRUE, eval = TRUE}
starwars %>%
 group_by(species) %>%
 na.omit() %>%
 summarise(pop_var(birth_year)) %>%
 rename(`age variance by species` = `pop_var(birth_year)`) %>%
 ungroup() %>%
 na.omit()
```

.right[`r fa("stop", fill = "#ff6347")`]

---

### Side Note: More about Summarise

You can find a list of commands that may be used with `summarise` [here](https://www.guru99.com/r-aggregate-function.html)

.right[`r fa("link", fill = "#5cb85c")`]

---

# Range
**Maximum**
```{r echo = TRUE, eval = TRUE}
starwars %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(max(birth_year)) %>%
  rename(`maximum age by species` = `max(birth_year)`) %>%
  ungroup() %>%
  na.omit()
```

---

**Minimum**
```{r echo = TRUE, eval = TRUE}
starwars %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(min(birth_year)) %>%
  rename(`minimum age by species` = `min(birth_year)`) %>%
  ungroup() %>%
  na.omit()
```

---

**Range**
```{r echo = TRUE, eval = TRUE}
starwars %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(max(birth_year), min(birth_year)) %>%
  rename(`max` = `max(birth_year)`) %>%
  rename(`min` = `min(birth_year)`) %>%
  ungroup() %>%
  na.omit() %>%
  mutate(`age range by species` = max - min) 
```

.left[`r fa("bookmark", fill = "#5bc0de")`]

---

# Plots

We'll use the sample mean age for all of the species
```{r echo = TRUE, eval = TRUE}
starwars_by_species <- starwars %>%
  group_by(species) %>%
  na.omit() %>%
  summarise(mean(birth_year)) %>%
  rename(`mean age by species` = `mean(birth_year)`) %>%
  ungroup() %>%
  arrange(`mean age by species`)
```

---

### Side Note: R Graph Gallery 

Want some inspiration or just want to copy code? Good! Head over to [The R Graph Gallery](https://www.r-graph-gallery.com/) to see some examples of basic visualizations and plots you can do in R right now.

.right[`r fa("link", fill = "#5cb85c")`]

---

## Bar Plot
```{r echo = TRUE, eval = TRUE, fig.align='center', out.width = "40%"}
ggplot(starwars_by_species, aes(x = species, 
                                y = `mean age by species`, 
                                fill = `mean age by species`)) +
  geom_bar(stat='identity') +
  scale_fill_gradient(low = "tomato", 
                      high = "steelblue") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45))
```

---

## Ordered Bar Plot 
Use `reorder` to order the bars from least to greatest. 
```{r echo = TRUE, eval = TRUE, fig.align='center', out.width = "35%"}
ggplot(starwars_by_species, aes(x = reorder(species, 
                                            `mean age by species`), 
                                y = `mean age by species`, 
                                fill = `mean age by species`)) +
       geom_bar(stat='identity') +
       scale_fill_gradient(low = "tomato", 
                           high = "steelblue") +
       theme_minimal() +
  theme(axis.text.x = element_text(angle = 45))
```

---

### Side Note: The Other Direction
Want greatest to least? Stick a `-` in front of `mean age by species` within `reorder()`.
```{r echo = TRUE, eval = TRUE, fig.align='center', out.width = "25%"}
ggplot(starwars_by_species, aes(x = reorder(species, 
                                            -`mean age by species`), 
                                y = `mean age by species`, 
                                fill = `mean age by species`)) +
       geom_bar(stat='identity') +
       scale_fill_gradient(low = "tomato", 
                           high = "steelblue") +
       theme_minimal() +
  theme(axis.text.x = element_text(angle = 45))
```

.right[`r fa("stop", fill = "#ff6347")`]

---

### Side Note: Using Hex Color Codes

You could have used the hex color codes `#ff6347` for `tomato` and `#4682b4` for `steelblue`. 

You can find more about hex colors using a web search for "hex color codes". For example, here is a [site](https://www.color-hex.com/) I use.

.right[`r fa("link", fill = "#5cb85c")`]

---

## Line Plot
```{r echo = TRUE, eval = TRUE, fig.align='center', out.width = "35%"}
ggplot(starwars_by_species, aes(x = reorder(species, 
                                            `mean age by species`),
                                y = `mean age by species`,
                                group = 1,
                                fill = `mean age by species`)) +
 geom_line(size = 1.5)+
  geom_point(size = 4) +
  scale_fill_gradient(low = "tomato", 
                      high = "steelblue") +
  theme_minimal()
```

---

## Pie Chart
```{r echo = TRUE, eval = FALSE, fig.align='center', out.width = "40%"}
starwars_by_species_pc <- starwars_by_species %>%
  arrange(desc(`mean age by species`)) %>%
  mutate(prop = `mean age by species` / 
           sum(starwars_by_species$`mean age by species`) *100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop )
```

```{r echo = TRUE, eval = FALSE, fig.align='center', out.width = "40%"}
 ggplot(starwars_by_species_pc, aes(x = "", 
                                   y = prop, 
                                   fill = `mean age by species`)) +
  geom_bar(stat="identity", 
           width=1, 
           color="white")  +
  coord_polar("y", start = 0) +
  geom_label(aes(y = ypos, 
                 label = `species`), 
             color = "white", 
             size=6) +
  scale_fill_gradient(low = "tomato", 
                      high = "steelblue") +
  theme_void()
```

.right[`r fa("forward", fill = "#4682b4")`]

---

```{r echo = FALSE, eval = TRUE, fig.align='center', out.width = "75%"}
starwars_by_species_pc <- starwars_by_species %>%
  arrange(desc(`mean age by species`)) %>%
  mutate(prop = `mean age by species` / sum(starwars_by_species$`mean age by species`) * 100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop )

 ggplot(starwars_by_species_pc, aes(x = "", 
                                   y = prop, 
                                   fill = `mean age by species`)) +
  geom_bar(stat="identity", 
           width=1, 
           color="white")  +
  coord_polar("y", start = 0) +
  geom_label(aes(y = ypos, 
                 label = `species`), 
             color = "white", 
             size=6) +
  scale_fill_gradient(low = "tomato", 
                      high = "steelblue") +
  theme_void()
```

---

## Thats it!